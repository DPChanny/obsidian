`UCommonActivatableWidgetStack`은 **활성화 가능한 위젯(`UCommonActivatableWidget`)들을 체계적으로 관리하기 위한 컨테이너**입니다. 이름 그대로, 위젯들을 **스택(Stack)** 자료구조 방식으로 처리하여 복잡한 UI 흐름을 손쉽게 제어하도록 돕는 핵심적인 컴포넌트입니다.

가장 쉬운 비유는 책상 위의 **서류 더미(Stack of papers)** 입니다. 가장 위에 있는 서류만 볼 수 있고, 그 서류를 치워야만 아래 서류를 볼 수 있는 것처럼 동작합니다.

---

### 주요 역할 및 기능

#### 1. 위젯의 생성 및 소멸 관리 (Lifecycle Management)

`WidgetStack`은 위젯의 생명주기를 완벽하게 통제합니다.

- **Push**: `PushWidgetClass` 함수가 호출되면, 지정된 위젯 클래스의 **새로운 인스턴스를 생성**하여 스택의 가장 위에 쌓습니다. 그 후, 해당 인스턴스의 `OnActivated()` 함수를 호출하여 활성화시킵니다.
    
- **Pop**: 스택의 가장 위에 있는 위젯에서 `DeactivateWidget()`을 호출하면, `WidgetStack`은 해당 위젯의 `OnDeactivated()` 함수를 호출한 뒤 스택에서 제거합니다. 제거된 위젯 인스턴스는 가비지 컬렉션에 의해 소멸됩니다.
    

이러한 자동화된 생성/소멸 관리 덕분에 개발자는 메모리 관리에 신경 쓸 필요 없이 UI를 동적으로 추가하고 제거할 수 있습니다.

#### 2. 상태 자동 관리 (Automatic State Management)

`WidgetStack`의 가장 강력한 기능 중 하나는 스택의 상태에 따라 위젯들의 표시 여부를 자동으로 관리하는 것입니다.

새로운 위젯이 스택에 푸시(Push)되면, 바로 아래에 있던 이전 위젯은 설정에 따라 자동으로 처리됩니다.

- **기본 동작**: 이전 위젯을 화면에서 숨깁니다 (`Hidden` 상태).
    
- **설정 가능**: 이전 위젯을 숨기지 않고 그대로 두거나, 레이아웃 공간까지 없애버리는(`Collapsed` 상태) 등의 동작을 선택할 수 있습니다.
    

이 기능 덕분에 팝업이 떴을 때 배경 UI를 수동으로 숨기거나 비활성화할 필요가 없어집니다.

#### 3. 입력 흐름 제어 (Input Flow Control)

`WidgetStack`은 입력 처리를 매우 명확하게 만듭니다.

- **입력 독점**: 오직 스택의 **가장 위에 있는 활성화된(Active) 위젯**만이 사용자 입력을 받을 수 있습니다.
    
- **입력 차단**: 상위 위젯이 활성화되어 있는 동안, 그 아래에 있는 모든 위젯과 게임 월드는 기본적으로 입력을 받지 못합니다. 이로 인해 팝업창 뒤에 있는 버튼이 눌리는 등의 버그를 원천적으로 방지할 수 있습니다. (이 동작은 `GetDesiredInputConfig` 함수를 통해 커스터마이징이 가능합니다.)
    

#### 4. UI 레이어링 (UI Layering)

`PushWidgetClass` 함수를 사용할 때 `Layer Name`을 지정할 수 있습니다. 이는 Z-Order(화면에 그려지는 순서)를 관리하여 서로 다른 목적의 UI 그룹을 분리하는 데 사용됩니다.

예를 들어, `Game` 레이어, `Menu` 레이어, `Modal` 레이어 등을 정의할 수 있습니다. `Modal` 레이어는 항상 `Menu` 레이어보다 위에 표시되도록 규칙을 정할 수 있어, UI가 겹쳤을 때의 순서를 명확하게 제어할 수 있습니다.

---

### 왜 사용하는가?

`WidgetStack`을 사용하지 않는다면, 개발자는 `CreateWidget`, `AddToViewport`, `SetVisibility`, `RemoveFromParent`, 입력 모드 설정 등 수많은 함수를 직접 호출하며 UI의 모든 상태를 수동으로 관리해야 합니다. 이 과정은 코드를 복잡하게 만들고 버그를 유발하기 쉽습니다.

`UCommonActivatableWidgetStack`은 이 모든 복잡한 과정을 **"스택에 넣는다(Push)"**와 **"스택에서 뺀다(Pop)"**는 두 가지 단순한 개념으로 추상화하여, **견고하고 예측 가능하며 유지보수하기 쉬운 UI 아키텍처**를 만들 수 있도록 지원합니다.