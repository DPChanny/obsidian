## 1. SQL에서 GROUP BY가 정확히 뭐였지?
SQL에서 GROUP BY 절은 특정 열(column)의 값이 동일한 행(row)들을 하나의 그룹으로 묶어주는 역할을 합니다. 이렇게 그룹화된 데이터를 바탕으로 각 그룹에 대한 집계(aggregation)를 계산하여, 데이터 요약 및 분석에 매우 유용하게 사용됩니다.

쉽게 말해, '부서별 평균 급여', '상품 카테고리별 판매량', '지역별 사용자 수'와 같이 특정 기준에 따라 데이터를 요약하고 싶을 때 사용합니다.

### GROUP BY의 핵심: 집계 함수와의 결합

GROUP BY는 단독으로 사용되기보다는 주로 **집계 함수(Aggregate Functions)**와 함께 사용될 때 강력한 기능을 발휘합니다. 집계 함수는 여러 행의 값을 바탕으로 단일 값을 계산하는 함수입니다.

주요 집계 함수는 다음과 같습니다:

- COUNT(): 그룹에 포함된 행의 개수를 셉니다.
- SUM(): 그룹에 포함된 모든 값의 합계를 구합니다.
- AVG(): 그룹에 포함된 모든 값의 평균을 구합니다.
- MAX(): 그룹에 포함된 값 중 최댓값을 찾습니다.
- MIN(): 그룹에 포함된 값 중 최솟값을 찾습니다.
    

### GROUP BY 사용법 및 예시

기본적인 GROUP BY의 문법은 다음과 같습니다.

```sql
SELECT column1, aggregate_function(column2)
FROM table_name
WHERE condition
GROUP BY column1;
```

**예시: 직원 테이블(employees)**

|id|name|department|salary|
|---|---|---|---|
|1|김철수|영업|5000|
|2|이영희|개발|6000|
|3|박민준|영업|4500|
|4|최유리|마케팅|5200|
|5|정재훈|개발|7000|
|6|윤지아|영업|5500|

**1. 부서별 직원 수 구하기**

```sql
SELECT
    department,
    COUNT(*) AS '직원 수'
FROM
    employees
GROUP BY
    department;
```

**결과:**

|department|직원 수|
|---|---|
|영업|3|
|개발|2|
|마케팅|1|

**2. 부서별 평균 급여 구하기**

```sql

SELECT
    department,
    AVG(salary) AS '평균 급여'
FROM
    employees
GROUP BY
    department;
```

**결과:**

|department|평균 급여|
|---|---|
|영업|5000|
|개발|6500|
|마케팅|5200|

## 2. GROUP BY나 집계 함수가 없다면?

**원본 테이블 (employees)**

|id|name|department|salary|
|---|---|---|---|
|1|김철수|영업|5000|
|2|이영희|개발|6000|
|3|박민준|영업|4500|
|4|최유리|마케팅|5200|
|5|정재훈|개발|7000|
|6|윤지아|영업|5500|

---

### **1. `GROUP BY` 절이 없는 경우**

만약 `$$`GROUP BY`$$` 절을 생략하고 집계 함수만 사용하면, 쿼리는 테이블 전체를 하나의 큰 그룹으로 간주하고 계산합니다.

#### **예시 1: 부서별 직원 수 쿼리에서 `GROUP BY`가 없다면?**

```sql
-- GROUP BY가 없는 쿼리
SELECT
    department,
    COUNT(*) AS '직원 수'
FROM
    employees;
```

**결과: 오류 발생!**

- **이유**: 대부분의 데이터베이스 시스템(Oracle, PostgreSQL, SQL Server 등)에서는 이 쿼리를 실행하면 오류가 발생합니다. `$$`COUNT(*)`$$`는 전체 6명의 직원을 세어 `6`이라는 단일 값을 반환하지만, `department` 열에는 '영업', '개발', '마케팅' 등 여러 값이 있기 때문입니다. 데이터베이스는 단 하나의 집계 결과(`6`) 옆에 여러 `department` 값 중 어떤 것을 표시해야 할지 알 수 없어 논리적 모순이 발생합니다.
    
- **MySQL의 경우**: 일부 설정의 MySQL에서는 오류 대신 임의의 `department` 값 하나와 전체 개수를 반환하기도 하지만, 이는 의도한 결과가 아니며 예측 불가능하므로 사용해서는 안 됩니다.
    

#### **예시 2: 부서별 평균 급여 쿼리에서 `GROUP BY`가 없다면?**

```sql
-- GROUP BY가 없는 쿼리
SELECT
    department,
    AVG(salary) AS '평균 급여'
FROM
    employees;
```

**결과: 오류 발생!**

- **이유**: 위와 동일합니다. `$$`AVG(salary)`$$`는 전체 직원의 평균 급여(5533.33)라는 단일 값을 계산하지만, 여러 `department` 값 중 어떤 것을 함께 표시할지 알 수 없기 때문입니다.
    

> **결론**: 집계 함수를 사용하면서 집계의 기준이 아닌 다른 열을 함께 조회하려면, 반드시 그 열을 GROUP BY 절에 명시해야 합니다.

---

### **2. 집계 함수가 없는 경우**

GROUP BY 절은 그대로 두고 집계 함수만 생략하면, 그룹화된 기준 열의 고유한(Unique) 값 목록을 얻게 됩니다.

#### **예시 1, 2: 부서별 통계 쿼리에서 집계 함수가 없다면?**

SQL

```
-- 집계 함수가 없는 쿼리
SELECT
    department
FROM
    employees
GROUP BY
    department;
```

**결과:**

|department|
|---|
|영업|
|개발|
|마케팅|

- **이유**: GROUP BY department는 '영업' 그룹, '개발' 그룹, '마케팅' 그룹으로 행들을 묶습니다. 그 후 SELECT department를 통해 각 그룹의 이름('영업', '개발', '마케팅')을 한 번씩만 보여줍니다.
    
- **DISTINCT와의 관계**: 이 결과는 사실상 아래의 DISTINCT 키워드를 사용한 쿼리와 완전히 동일합니다. DISTINCT는 중복된 값을 제거하고 고유한 값만 보여주는 역할을 합니다.
    

SQL

```
SELECT DISTINCT department FROM employees;
```

> **결론**: 집계 함수 없이 GROUP BY만 사용하면, 그룹화된 열의 중복이 제거된 목록을 얻을 수 있습니다.

# 3. GROUP BY 1 2 3 4는 뭘까?

`GROUP BY`에 여러 컬럼을 사용하는 것은 **"더 세분화된 그룹"**을 만드는 것이다. `$$GROUP BY$$`에 지정된 **모든 컬럼 값의 조합(Combination)이 완전히 동일한 행들끼리 하나의 그룹**으로 묶인다.

### 예시

아래와 같은 판매 데이터 테이블(`sales`)이 있다고 가정하자.

|년도(year)|분기(quarter)|지역(region)|판매량(amount)|
|---|---|---|---|
|2024|1|서울|100|
|2024|1|서울|150|
|2024|1|부산|80|
|2024|2|서울|200|
|2024|2|부산|120|
|2024|2|부산|130|

#### Case 1: 컬럼 하나로 GROUP BY (`region`)

`region` 값이 같은 것끼리만 묶는다.

```sql
SELECT region, SUM(amount) AS '총 판매량'
FROM sales
GROUP BY region;
```

**결과:** | region | 총 판매량 | | :--- | -----: | | 서울 | 450 | | 부산 | 330 |

#### Case 2: 여러 컬럼으로 GROUP BY (`quarter`, `region`)

`$$quarter$$`와 `$$region$$` **두 값의 조합이 모두 같은 것**끼리 묶는다.

- ('1분기', '서울') 그룹
    
- ('1분기', '부산') 그룹
    
- ('2분기', '서울') 그룹
    
- ('2분기', '부산') 그룹
    

```sql
SELECT quarter, region, SUM(amount) AS '총 판매량'
FROM sales
GROUP BY quarter, region;
```

**결과:** | quarter | region | 총 판매량 | | :--- | :--- | -----: | | 1 | 서울 | 250 | | 1 | 부산 | 80 | | 2 | 서울 | 200 | | 2 | 부산 | 250 |